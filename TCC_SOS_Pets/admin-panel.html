{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - S.O.S Pets</title>
    <link rel="icon" type="image/png" href="{% static 'Estetica_site/Logo.png' %}">
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <style>
        body {
            background: linear-gradient(to bottom, #ffffff, #e8f5e9);
            background-attachment: fixed;
        }

        .admin-container {
            max-width: 1400px;
            margin: 20px auto 40px;
            padding: 20px;
        }

        .admin-header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.3);
        }

        .admin-header h1 {
            margin: 0;
            font-size: 2em;
            font-family: 'Poppins', sans-serif;
        }

        .admin-header p {
            margin: 10px 0 0 0;
            opacity: 0.95;
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 15px 30px;
            background: white;
            border: none;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            position: relative;
            font-family: 'Poppins', sans-serif;
        }

        .admin-tab:hover {
            background: #f5f5f5;
            color: #333;
        }

        .admin-tab.active {
            background: #4CAF50;
            color: white;
        }

        .admin-tab .badge {
            background: #ff4757;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 8px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .items-grid {
            display: grid;
            gap: 20px;
        }

        .item-card {
            background: white;
            border-radius: 15px;
            padding: 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border: 1px solid #eee;
            overflow: hidden;
        }

        .item-card:hover {
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .item-card.collapsed {
            padding: 0;
        }

        .item-header-compact {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .item-header-compact:hover {
            background: #f8f9fa;
        }

        .item-header-left {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .item-header-right {
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 0.9em;
            color: #666;
        }

        .item-title-compact {
            font-size: 1em;
            font-weight: 500;
            color: #333;
            margin: 0;
            font-family: 'Roboto', sans-serif;
        }

        .item-location, .item-date {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .expand-icon {
            transition: transform 0.3s;
            color: #4CAF50;
            font-size: 1.2em;
        }

        .item-content {
            padding: 0 25px 25px 25px;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 2000px;
            }
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .item-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #333;
            margin: 0;
            font-family: 'Poppins', sans-serif;
        }

        .status-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pendente {
            background: #fff3cd;
            color: #856404;
        }

        .status-aprovada {
            background: #d4edda;
            color: #155724;
        }

        .status-em_andamento {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-resolvida {
            background: #e2e3e5;
            color: #383d41;
        }

        .status-rejeitada {
            background: #f8d7da;
            color: #721c24;
        }
        
        .categoria-badge {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .categoria-maus_tratos {
            background: #ffe0e0;
            color: #c41e3a;
        }
        
        .categoria-abandono {
            background: #fff4e0;
            color: #d97706;
        }
        
        .categoria-acumulacao {
            background: #ffe4f1;
            color: #be185d;
        }
        
        .categoria-animal_perdido {
            background: #e0f2ff;
            color: #0369a1;
        }
        
        .categoria-animal_ferido {
            background: #ffe0f0;
            color: #be123c;
        }
        
        .categoria-outros {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        /* Timeline de Hist√≥rico */
        .timeline-container {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .timeline-header h4 {
            color: #2d3436;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-add-comment {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        
        .btn-add-comment:hover {
            background: #45a049;
        }
        
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #ddd;
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            padding-left: 20px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: white;
            border: 3px solid;
            z-index: 1;
        }
        
        .timeline-item.tipo-criacao::before {
            border-color: #4CAF50;
        }
        
        .timeline-item.tipo-status::before {
            border-color: #2196F3;
        }
        
        .timeline-item.tipo-comentario::before {
            border-color: #FF9800;
        }
        
        .timeline-content {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .timeline-header-info {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .timeline-type {
            font-weight: 600;
            color: #2d3436;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .timeline-date {
            font-size: 0.85em;
            color: #999;
        }
        
        .timeline-user {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }
        
        .timeline-message {
            color: #2d3436;
            line-height: 1.5;
        }
        
        .timeline-status-change {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            margin-top: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .comment-form {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        
        .comment-form.active {
            display: block;
        }
        
        .comment-form textarea {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-family: 'Roboto', sans-serif;
            resize: vertical;
            margin-bottom: 10px;
        }
        
        .comment-form textarea:focus {
            border-color: #4CAF50;
            outline: none;
        }
        
        .comment-form-actions {
            display: flex;
            gap: 10px;
        }
        
        .comment-form button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        
        .comment-form .btn-submit {
            background: #4CAF50;
            color: white;
        }
        
        .comment-form .btn-cancel {
            background: #e0e0e0;
            color: #666;
        }

        .item-details {
            margin: 15px 0;
            color: #666;
            line-height: 1.6;
        }

        .item-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin: 15px 0;
            font-size: 0.9em;
            color: #999;
        }

        .item-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .item-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-action {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Roboto', sans-serif;
        }

        .btn-aprovar {
            background: #4CAF50;
            color: white;
        }

        .btn-aprovar:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .btn-rejeitar {
            background: #f44336;
            color: white;
        }

        .btn-rejeitar:hover {
            background: #da190b;
            transform: scale(1.05);
        }

        .btn-em-andamento {
            background: #2196F3;
            color: white;
        }

        .btn-em-andamento:hover {
            background: #0b7dda;
            transform: scale(1.05);
        }

        .btn-resolver {
            background: #9C27B0;
            color: white;
        }

        .btn-resolver:hover {
            background: #7b1fa2;
            transform: scale(1.05);
        }

        .btn-ver-detalhes {
            background: #757575;
            color: white;
        }

        .btn-ver-detalhes:hover {
            background: #616161;
            transform: scale(1.05);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .empty-state i {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.3;
            color: #4CAF50;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #666;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .loading i {
            animation: spin 1s linear infinite;
            color: #4CAF50;
        }

        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        .item-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 10px;
            margin: 15px 0;
            border: 1px solid #eee;
        }
        
        .media-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .media-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            cursor: pointer;
        }
        
        .media-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .media-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }
        
        .media-item video {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }
        
        .media-item .media-type-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
        }
        
        .media-lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }
        
        .media-lightbox.active {
            display: flex;
        }
        
        .media-lightbox-content {
            max-width: 90%;
            max-height: 90%;
        }
        
        .media-lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10001;
        }
        
        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            font-size: 30px;
            padding: 20px 15px;
            cursor: pointer;
            z-index: 10001;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .lightbox-nav:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: translateY(-50%) scale(1.1);
        }
        
        .lightbox-prev {
            left: 20px;
        }
        
        .lightbox-next {
            right: 20px;
        }
        
        .lightbox-counter {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 600;
            z-index: 10001;
        }
        
        .mini-map {
            height: 200px;
            border-radius: 8px;
            margin: 10px 0;
            border: 2px solid #ddd;
        }

        .observacoes-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Roboto', sans-serif;
            resize: vertical;
            min-height: 60px;
            box-sizing: border-box;
        }

        .observacoes-input:focus {
            border-color: #4CAF50;
            outline: none;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.3);
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            border: 1px solid #eee;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            color: #4CAF50;
            margin: 10px 0;
            font-family: 'Poppins', sans-serif;
        }
        
        .category-stats {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border: 1px solid #eee;
        }
        
        .category-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }
        
        .category-stat-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid;
            display: flex;
            flex-direction: column;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .category-stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .category-stat-item .category-name {
            font-size: 1.1em;
            font-weight: 600;
            color: #2d3436;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .category-stat-item .category-count {
            font-size: 2em;
            font-weight: 700;
            color: #636e72;
        }
        
        .category-stat-item.maus_tratos {
            border-left-color: #c41e3a;
        }
        
        .category-stat-item.abandono {
            border-left-color: #d97706;
        }
        
        .category-stat-item.acumulacao {
            border-left-color: #be185d;
        }
        
        .category-stat-item.animal_perdido {
            border-left-color: #0369a1;
        }
        
        .category-stat-item.animal_ferido {
            border-left-color: #be123c;
        }
        
        .category-stat-item.outros {
            border-left-color: #6b7280;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        /* Estilos para a barra de busca */
        .search-section {
            margin-bottom: 30px;
        }
        
        .search-bar {
            background: white;
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #e8f5e9;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s;
        }
        
        .search-bar:focus-within {
            border-color: #4CAF50;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.2);
        }
        
        .search-bar i {
            color: #4CAF50;
            font-size: 1.2em;
        }
        
        .search-bar input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 1em;
            font-family: 'Roboto', sans-serif;
            padding: 8px 0;
        }
        
        .search-bar input::placeholder {
            color: #999;
        }
        
        /* Estilos para os filtros */
        .filters-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border: 1px solid #eee;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e8f5e9;
        }
        
        .filters-header h3 {
            color: #2d3436;
            font-size: 1.3em;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-clear-filters {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-clear-filters:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }
        
        .filters-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filter-group label {
            font-weight: 600;
            color: #2d3436;
            font-size: 0.95em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-group input,
        .filter-group select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95em;
            transition: all 0.3s;
            font-family: 'Roboto', sans-serif;
        }
        
        .filter-group input:focus,
        .filter-group select:focus {
            border-color: #4CAF50;
            outline: none;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.3);
        }
        
        .filter-active-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 20px;
        }
        
        .filter-tag {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            animation: fadeIn 0.3s ease;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-tag:hover {
            background: linear-gradient(135deg, #45a049 0%, #3d8b40 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }
        
        .filter-tag .remove-filter {
            margin-left: 5px;
            font-size: 1.3em;
            font-weight: bold;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        
        .filter-tag:hover .remove-filter {
            opacity: 1;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .stat-card.clickable {
            cursor: pointer;
        }
        
        .stat-card.clickable:active {
            transform: translateY(-1px);
        }
        
        .stat-card.filtered {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
        }
        
        .stat-card.filtered .stat-number,
        .stat-card.filtered .stat-label {
            color: white;
        }
        
        .stat-card.filtered i {
            color: white !important;
        }


        .stat-card i {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <header>
        <a href="/" class="header-logo-link">
            <i class="fas fa-paw"></i>
            <span class="logo-text">S.O.S Pets</span>
        </a>
        <nav>
            <a href="/adocao/"><i class="fas fa-heart"></i><span>Ado√ß√£o</span></a>
            <a href="/arrecadacao/"><i class="fas fa-hand-holding-heart"></i><span>Arrecada√ß√£o</span></a>
            <a href="/denuncia/"><i class="fas fa-bullhorn"></i><span>Den√∫ncia</span></a>
            <a href="/animais-perdidos/"><i class="fas fa-search"></i><span>Pets Perdidos</span></a>
            <a href="/contato/"><i class="fas fa-envelope"></i><span>Contato</span></a>
            <div class="nav-user-area"></div>
        </nav>
    </header>

    <div class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-shield-alt"></i> Painel Administrativo</h1>
            <p>Gerencie den√∫ncias, ado√ß√µes e mensagens de contato</p>
        </div>

        <!-- Abas do Admin (logo abaixo do cabe√ßalho) -->
        <div class="admin-tabs">
            <button class="admin-tab active" data-tab="denuncias">
                <i class="fas fa-bullhorn"></i> Den√∫ncias
                <span class="badge" id="badge-denuncias">0</span>
            </button>
            <button class="admin-tab" data-tab="adocoes">
                <i class="fas fa-heart"></i> Ado√ß√µes
                <span class="badge" id="badge-adocoes">0</span>
            </button>
            <button class="admin-tab" data-tab="contatos">
                <i class="fas fa-envelope"></i> Contatos
                <span class="badge" id="badge-contatos">0</span>
            </button>
        </div>

        <!-- Conte√∫do da aba Den√∫ncias -->
        <div id="denuncias-tab" class="tab-content active">
            <!-- Estat√≠sticas de Den√∫ncias -->
            <div class="stats-cards">
                <div class="stat-card clickable" onclick="filterByStatus('')">
                    <i class="fas fa-list-alt" style="font-size: 2em; color: #6c5ce7;"></i>
                    <div class="stat-number" id="stat-total-denuncias">0</div>
                    <div class="stat-label">Total de Den√∫ncias</div>
                </div>
                <div class="stat-card clickable" onclick="filterByStatus('pendente')">
                    <i class="fas fa-clock" style="font-size: 2em; color: #fdcb6e;"></i>
                    <div class="stat-number" id="stat-denuncias">0</div>
                    <div class="stat-label">Den√∫ncias Pendentes</div>
                </div>
                <div class="stat-card clickable" onclick="filterByStatus('em_andamento')">
                    <i class="fas fa-hourglass-half" style="font-size: 2em; color: #74b9ff;"></i>
                    <div class="stat-number" id="stat-denuncias-andamento">0</div>
                    <div class="stat-label">Em Andamento</div>
                </div>
                <div class="stat-card clickable" onclick="filterByStatus('resolvida')">
                    <i class="fas fa-check-circle" style="font-size: 2em; color: #00b894;"></i>
                    <div class="stat-number" id="stat-denuncias-resolvidas">0</div>
                    <div class="stat-label">Resolvidas</div>
                </div>
            </div>
            
            <!-- Estat√≠sticas por Categoria -->
            <div class="category-stats" id="category-stats" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #2d3436;">
                    <i class="fas fa-chart-pie"></i> Den√∫ncias por Categoria
                </h3>
                <div class="category-stats-grid" id="category-stats-grid">
                    <!-- Ser√° preenchido dinamicamente -->
                </div>
            </div>

            <!-- Barra de Busca (sempre vis√≠vel) -->
            <div class="search-section">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="Buscar den√∫ncias por denunciante, descri√ß√£o, localiza√ß√£o..." onfocus="showFilters()" onkeyup="applyFilters()" onkeypress="if(event.key === 'Enter') applyFilters(true)">
                </div>
            </div>

            <!-- Filtros Avan√ßados (aparecem ao clicar nos cards) -->
            <div class="filters-section" id="filters-section" style="display: none;">
                <div class="filters-header">
                    <h3><i class="fas fa-filter"></i> Filtros Avan√ßados</h3>
                    <button class="btn-clear-filters" onclick="clearFilters()">
                        <i class="fas fa-times"></i> Limpar Filtros
                    </button>
                </div>
                
                <div class="filters-content">
                    <div class="filter-group">
                        <label for="filter-status"><i class="fas fa-flag"></i> Status</label>
                        <select id="filter-status" onchange="applyFilters()">
                            <option value="">Todos os status</option>
                            <option value="pendente">Pendente</option>
                            <option value="em_andamento">Em Andamento</option>
                            <option value="resolvida">Resolvida</option>
                            <option value="rejeitada">Rejeitada</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filter-categoria"><i class="fas fa-tags"></i> Categoria</label>
                        <select id="filter-categoria" onchange="applyFilters()">
                            <option value="">Todas as categorias</option>
                            <option value="maus_tratos">üêæ Maus-tratos</option>
                            <option value="abandono">üè† Abandono</option>
                            <option value="acumulacao">üêï Acumula√ß√£o</option>
                            <option value="animal_perdido">üîç Animal Perdido</option>
                            <option value="animal_ferido">üè• Animal Ferido</option>
                            <option value="outros">‚ö†Ô∏è Outros</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filter-data"><i class="fas fa-calendar"></i> Data</label>
                        <select id="filter-data" onchange="applyFilters()">
                            <option value="">Todas as datas</option>
                            <option value="hoje">Hoje</option>
                            <option value="semana">√öltima semana</option>
                            <option value="mes">√öltimo m√™s</option>
                            <option value="tres_meses">√öltimos 3 meses</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-active-tags" id="filter-active-tags"></div>
            </div>
            
            <!-- Lista de Den√∫ncias -->
            <div class="loading">
                <i class="fas fa-spinner"></i> Carregando den√∫ncias...
            </div>
            <div class="items-grid" id="denuncias-grid"></div>
        </div>

        <!-- Conte√∫do da aba Ado√ß√µes -->
        <div id="adocoes-tab" class="tab-content">
            <!-- Estat√≠sticas de Ado√ß√µes (futuramente) -->
            <div class="stats-cards">
                <div class="stat-card">
                    <i class="fas fa-heart" style="font-size: 2em; color: #e84393;"></i>
                    <div class="stat-number" id="stat-adocoes">0</div>
                    <div class="stat-label">Ado√ß√µes Pendentes</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-check-circle" style="font-size: 2em; color: #00b894;"></i>
                    <div class="stat-number" id="stat-adocoes-aprovadas">0</div>
                    <div class="stat-label">Ado√ß√µes Aprovadas</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-times-circle" style="font-size: 2em; color: #d63031;"></i>
                    <div class="stat-number" id="stat-adocoes-rejeitadas">0</div>
                    <div class="stat-label">Ado√ß√µes Rejeitadas</div>
                </div>
            </div>
            
            <!-- Lista de Ado√ß√µes -->
            <div class="loading">
                <i class="fas fa-spinner"></i> Carregando ado√ß√µes...
            </div>
            <div class="items-grid" id="adocoes-grid"></div>
        </div>

        <!-- Conte√∫do da aba Contatos -->
        <div id="contatos-tab" class="tab-content">
            <!-- Estat√≠sticas de Contatos (futuramente) -->
            <div class="stats-cards">
                <div class="stat-card">
                    <i class="fas fa-envelope" style="font-size: 2em; color: #0984e3;"></i>
                    <div class="stat-number" id="stat-contatos">0</div>
                    <div class="stat-label">Contatos N√£o Lidos</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-envelope-open" style="font-size: 2em; color: #00b894;"></i>
                    <div class="stat-number" id="stat-contatos-lidos">0</div>
                    <div class="stat-label">Contatos Lidos</div>
                </div>
            </div>
            
            <!-- Lista de Contatos -->
            <div class="loading">
                <i class="fas fa-spinner"></i> Carregando contatos...
            </div>
            <div class="items-grid" id="contatos-grid"></div>
        </div>
    </div>

    <!-- Lightbox para visualiza√ß√£o de m√≠dia -->
    <div id="media-lightbox" class="media-lightbox" onclick="closeLightbox()">
        <span class="media-lightbox-close">&times;</span>
        <button class="lightbox-nav lightbox-prev" onclick="event.stopPropagation(); navigateLightbox(-1)">
            <i class="fas fa-chevron-left"></i>
        </button>
        <button class="lightbox-nav lightbox-next" onclick="event.stopPropagation(); navigateLightbox(1)">
            <i class="fas fa-chevron-right"></i>
        </button>
        <div class="lightbox-counter" id="lightbox-counter"></div>
        <div id="lightbox-content" class="media-lightbox-content" onclick="event.stopPropagation()"></div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <script src="{% static 'user_session.js' %}"></script>
    <script>
        const API_BASE = 'http://localhost:8000/api';
        
        // Vari√°veis globais para navega√ß√£o do lightbox
        let currentMediaList = [];
        let currentMediaIndex = 0;
        
        // Vari√°veis globais para filtros
        let allDenuncias = [];
        let filteredDenuncias = [];
        let activeFilters = {
            status: '',
            categoria: '',
            data: '',
            search: ''
        };

        // Gerenciamento de tabs
        document.querySelectorAll('.admin-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.dataset.tab;
                
                document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(`${tabName}-tab`).classList.add('active');
                
                loadTabData(tabName);
            });
        });

        // Verificar se o usu√°rio √© admin
        async function checkAdminAccess() {
            const token = localStorage.getItem('access');
            if (!token) {
                showAccessDenied('Voc√™ precisa estar logado como administrador.');
                return false;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/me/`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) {
                    showAccessDenied('Voc√™ precisa estar logado como administrador.');
                    return false;
                }
                
                const userData = await response.json();
                
                if (!userData.is_staff) {
                    showAccessDenied('Voc√™ precisa estar logado como administrador.');
                    return false;
                }
                
                return true;
            } catch (error) {
                console.error('Erro ao verificar acesso:', error);
                showAccessDenied('Erro ao verificar permiss√µes. Tente novamente.');
                return false;
            }
        }

        function showAccessDenied(message) {
            // Cria modal de acesso negado
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    padding: 40px;
                    border-radius: 15px;
                    text-align: center;
                    max-width: 400px;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                ">
                    <div style="font-size: 4em; color: #d63031; margin-bottom: 20px;">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <h2 style="color: #333; margin-bottom: 15px; font-size: 1.5em;">LOCALHOST:8000 DIZ</h2>
                    <p style="color: #666; margin-bottom: 30px; font-size: 1.1em;">${message}</p>
                    <button onclick="window.location.href='/login/'" style="
                        background: #d63031;
                        color: white;
                        border: none;
                        padding: 12px 30px;
                        border-radius: 8px;
                        font-size: 1em;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s;
                    " onmouseover="this.style.background='#c72828'" onmouseout="this.style.background='#d63031'">
                        OK
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Carregar dados ao iniciar
        async function init() {
            // Verifica acesso de admin primeiro
            const hasAccess = await checkAdminAccess();
            if (!hasAccess) {
                return;
            }

            await loadTabData('denuncias');
            updateStats();
        }

        async function loadTabData(tab) {
            switch(tab) {
                case 'denuncias':
                    await loadDenuncias();
                    break;
                case 'adocoes':
                    await loadAdocoes();
                    break;
                case 'contatos':
                    await loadContatos();
                    break;
            }
        }

        async function loadDenuncias() {
            const tabContent = document.getElementById('denuncias-tab');
            const loadingDiv = tabContent.querySelector('.loading');
            const grid = document.getElementById('denuncias-grid');
            const token = localStorage.getItem('access');
            
            try {
                const response = await fetch(`${API_BASE}/denuncias/`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) throw new Error('Erro ao carregar den√∫ncias');
                
                const data = await response.json();
                const denuncias = data.results || data;
                
                // Salva todas as den√∫ncias globalmente
                allDenuncias = denuncias;
                filteredDenuncias = denuncias;
                
                // Remove loading
                if (loadingDiv) loadingDiv.remove();
                
                // Renderiza as den√∫ncias filtradas
                renderDenuncias();
                
                // Atualiza estat√≠sticas com todas as den√∫ncias
                updateDenunciasStats(allDenuncias);
                
            } catch (error) {
                console.error('Erro:', error);
                if (loadingDiv) loadingDiv.remove();
                grid.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Erro ao carregar den√∫ncias</p></div>';
            }
        }
        
        function renderDenuncias() {
            const grid = document.getElementById('denuncias-grid');
            const denuncias = filteredDenuncias;
            
            if (denuncias.length === 0) {
                grid.innerHTML = '<div class="empty-state"><i class="fas fa-search"></i><p>Nenhuma den√∫ncia encontrada com os filtros aplicados</p></div>';
                return;
            }
            
            grid.innerHTML = denuncias.map(d => `
                    <div class="item-card collapsed" id="denuncia-${d.id}">
                        <div class="item-header-compact" onclick="toggleDenuncia(${d.id})">
                            <div class="item-header-left">
                                <span class="status-badge status-${d.status}">${getStatusLabel(d.status)}</span>
                                <span class="categoria-badge categoria-${d.categoria}">${getCategoriaInfo(d.categoria).icone} ${getCategoriaInfo(d.categoria).label}</span>
                                <h3 class="item-title-compact">${d.descricao.substring(0, 80)}${d.descricao.length > 80 ? '...' : ''}</h3>
                            </div>
                            <div class="item-header-right">
                                <span class="item-location"><i class="fas fa-map-marker-alt"></i> ${d.localizacao}</span>
                                <span class="item-date"><i class="fas fa-calendar"></i> ${new Date(d.data_criacao).toLocaleDateString('pt-BR')}</span>
                                <i class="fas fa-chevron-down expand-icon"></i>
                            </div>
                        </div>
                        
                        <div class="item-content" style="display: none;">
                            ${createMediaGallery(d)}
                            ${createTimeline(d)}
                            <div class="item-details">
                                <p><strong>Categoria:</strong> ${getCategoriaInfo(d.categoria).icone} ${getCategoriaInfo(d.categoria).label}</p>
                                <p><strong>Descri√ß√£o Completa:</strong> ${d.descricao}</p>
                                <p><strong>Localiza√ß√£o:</strong> ${d.localizacao}</p>
                                ${d.usuario_nome ? `<p><strong>Denunciante:</strong> ${d.usuario_nome}</p>` : '<p><strong>Denunciante:</strong> An√¥nimo</p>'}
                                ${d.moderador_nome ? `<p><strong>Moderador:</strong> ${d.moderador_nome}</p>` : ''}
                                ${d.observacoes_moderador ? `<p><strong>Observa√ß√µes do Moderador:</strong> ${d.observacoes_moderador}</p>` : ''}
                            </div>
                            ${d.status === 'pendente' ? `
                                <textarea class="observacoes-input" id="obs-denuncia-${d.id}" placeholder="Observa√ß√µes do moderador (opcional)"></textarea>
                                <div class="item-actions">
                                    <button class="btn-action btn-aprovar" onclick="moderarDenuncia(${d.id}, 'aprovar')">
                                        <i class="fas fa-check"></i> Aprovar
                                    </button>
                                    <button class="btn-action btn-em-andamento" onclick="moderarDenuncia(${d.id}, 'em_andamento')">
                                        <i class="fas fa-hourglass-half"></i> Em Andamento
                                    </button>
                                    <button class="btn-action btn-rejeitar" onclick="moderarDenuncia(${d.id}, 'rejeitar')">
                                        <i class="fas fa-times"></i> Rejeitar
                                    </button>
                                </div>
                            ` : d.status === 'aprovada' || d.status === 'em_andamento' ? `
                                <div class="item-actions">
                                    <button class="btn-action btn-resolver" onclick="moderarDenuncia(${d.id}, 'resolver')">
                                        <i class="fas fa-check-double"></i> Marcar como Resolvida
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
                
                // Adiciona event listeners para os items de m√≠dia
                setTimeout(() => {
                    // Para cada card de den√∫ncia, configura a navega√ß√£o de m√≠dia
                    denuncias.forEach(denuncia => {
                        const card = document.getElementById(`denuncia-${denuncia.id}`);
                        if (!card) return;
                        
                        const mediaItems = card.querySelectorAll('.media-item');
                        if (mediaItems.length === 0) return;
                        
                        // Cria lista de m√≠dias para esta den√∫ncia
                        const mediaList = [];
                        mediaItems.forEach((item, index) => {
                            const url = item.getAttribute('data-url');
                            const type = item.getAttribute('data-type');
                            if (url && type) {
                                mediaList.push({ url, type });
                                
                                // Adiciona evento de clique
                                item.addEventListener('click', function() {
                                    openLightboxWithNav(mediaList, index);
                                });
                            }
                        });
                    });
                }, 100);
        }

        async function loadAdocoes() {
            const tabContent = document.getElementById('adocoes-tab');
            const loadingDiv = tabContent.querySelector('.loading');
            const grid = document.getElementById('adocoes-grid');
            const token = localStorage.getItem('access');
            
            try {
                const response = await fetch(`${API_BASE}/adocoes/`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) throw new Error('Erro ao carregar ado√ß√µes');
                
                const data = await response.json();
                const adocoes = data.results || data;
                
                // Remove loading
                if (loadingDiv) loadingDiv.remove();
                
                if (adocoes.length === 0) {
                    grid.innerHTML = '<div class="empty-state"><i class="fas fa-check-circle"></i><p>Nenhuma ado√ß√£o pendente</p></div>';
                    return;
                }
                
                grid.innerHTML = adocoes.map(a => `
                    <div class="item-card">
                        <div class="item-header">
                            <h3 class="item-title">Ado√ß√£o #${a.id}</h3>
                            <span class="status-badge status-${a.status}">${getStatusLabel(a.status)}</span>
                        </div>
                        <div class="item-details">
                            <p><strong>Animal ID:</strong> ${a.animal}</p>
                            <p><strong>Usu√°rio ID:</strong> ${a.usuario}</p>
                            ${a.motivo_rejeicao ? `<p><strong>Motivo Rejei√ß√£o:</strong> ${a.motivo_rejeicao}</p>` : ''}
                        </div>
                        <div class="item-meta">
                            <span><i class="fas fa-calendar"></i> ${new Date(a.data_solicitacao).toLocaleDateString('pt-BR')}</span>
                        </div>
                        ${a.status === 'pendente' ? `
                            <div class="item-actions">
                                <button class="btn-action btn-aprovar" onclick="moderarAdocao(${a.id}, 'aprovada')">
                                    <i class="fas fa-check"></i> Aprovar Ado√ß√£o
                                </button>
                                <button class="btn-action btn-rejeitar" onclick="moderarAdocao(${a.id}, 'rejeitada')">
                                    <i class="fas fa-times"></i> Rejeitar Ado√ß√£o
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Erro:', error);
                if (loadingDiv) loadingDiv.remove();
                grid.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Erro ao carregar ado√ß√µes</p></div>';
            }
        }

        async function loadContatos() {
            const tabContent = document.getElementById('contatos-tab');
            const loadingDiv = tabContent.querySelector('.loading');
            const grid = document.getElementById('contatos-grid');
            
            // Remove loading
            if (loadingDiv) loadingDiv.remove();
            
            grid.innerHTML = '<div class="empty-state"><i class="fas fa-info-circle"></i><p>Funcionalidade de contatos em desenvolvimento. Por enquanto, use o Django Admin.</p></div>';
        }

        async function moderarDenuncia(id, acao) {
            const token = localStorage.getItem('access');
            const obs = document.getElementById(`obs-denuncia-${id}`)?.value || '';
            
            try {
                const response = await fetch(`${API_BASE}/denuncias/${id}/${acao}/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ observacoes: obs })
                });
                
                if (!response.ok) throw new Error('Erro ao moderar den√∫ncia');
                
                alert('Den√∫ncia atualizada com sucesso!');
                await loadDenuncias();
                updateStats();
                
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao atualizar den√∫ncia. Verifique se voc√™ tem permiss√£o de administrador.');
            }
        }

        async function moderarAdocao(id, novoStatus) {
            const token = localStorage.getItem('access');
            
            try {
                const response = await fetch(`${API_BASE}/adocoes/${id}/`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: novoStatus })
                });
                
                if (!response.ok) throw new Error('Erro ao moderar ado√ß√£o');
                
                alert('Ado√ß√£o atualizada com sucesso!');
                await loadAdocoes();
                updateStats();
                
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao atualizar ado√ß√£o. Verifique suas permiss√µes.');
            }
        }

        async function updateStats() {
            const token = localStorage.getItem('access');
            
            try {
                // Busca todas as den√∫ncias
                const denuncias = await fetch(`${API_BASE}/denuncias/`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                }).then(r => r.json());
                
                const denunciasArray = denuncias.results || denuncias;
                
                // Atualiza estat√≠sticas detalhadas de den√∫ncias
                updateDenunciasStats(denunciasArray);
                
                // Atualiza badge da aba
                const denunciasPendentes = denunciasArray.filter(d => d.status === 'pendente').length;
                document.getElementById('badge-denuncias').textContent = denunciasPendentes;
                
                // Ado√ß√µes
                const adocoes = await fetch(`${API_BASE}/adocoes/`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                }).then(r => r.json());
                const adocoesArray = adocoes.results || adocoes;
                const adocoesPendentes = adocoesArray.filter(a => a.status === 'pendente').length;
                const adocoesAprovadas = adocoesArray.filter(a => a.status === 'aprovada').length;
                const adocoesRejeitadas = adocoesArray.filter(a => a.status === 'rejeitada').length;
                
                document.getElementById('stat-adocoes').textContent = adocoesPendentes;
                document.getElementById('stat-adocoes-aprovadas').textContent = adocoesAprovadas;
                document.getElementById('stat-adocoes-rejeitadas').textContent = adocoesRejeitadas;
                document.getElementById('badge-adocoes').textContent = adocoesPendentes;
                
                // Contatos (placeholder)
                document.getElementById('stat-contatos').textContent = '‚Äî';
                document.getElementById('stat-contatos-lidos').textContent = '‚Äî';
                document.getElementById('badge-contatos').textContent = '0';
                
            } catch (error) {
                console.error('Erro ao atualizar estat√≠sticas:', error);
            }
        }

        function getStatusLabel(status) {
            const labels = {
                'pendente': 'Pendente',
                'aprovada': 'Aprovada',
                'em_andamento': 'Em Andamento',
                'resolvida': 'Resolvida',
                'rejeitada': 'Rejeitada',
                'cancelada': 'Cancelada'
            };
            return labels[status] || status;
        }
        
        function getCategoriaInfo(categoria) {
            const categorias = {
                'maus_tratos': { icone: 'üêæ', label: 'Maus-tratos' },
                'abandono': { icone: 'üè†', label: 'Abandono' },
                'acumulacao': { icone: 'üêï', label: 'Acumula√ß√£o' },
                'animal_perdido': { icone: 'üîç', label: 'Animal Perdido' },
                'animal_ferido': { icone: 'üè•', label: 'Animal Ferido' },
                'outros': { icone: '‚ö†Ô∏è', label: 'Outros' }
            };
            return categorias[categoria] || { icone: 'üìã', label: 'Sem categoria' };
        }
        
        function updateDenunciasStats(denuncias) {
            // Contadores por status
            const total = denuncias.length;
            const pendentes = denuncias.filter(d => d.status === 'pendente').length;
            const emAndamento = denuncias.filter(d => d.status === 'em_andamento').length;
            const resolvidas = denuncias.filter(d => d.status === 'resolvida').length;
            
            // Atualiza cards de estat√≠sticas
            document.getElementById('stat-total-denuncias').textContent = total;
            document.getElementById('stat-denuncias').textContent = pendentes;
            document.getElementById('stat-denuncias-andamento').textContent = emAndamento;
            document.getElementById('stat-denuncias-resolvidas').textContent = resolvidas;
            
            // Contadores por categoria
            const categorias = {
                'maus_tratos': 0,
                'abandono': 0,
                'acumulacao': 0,
                'animal_perdido': 0,
                'animal_ferido': 0,
                'outros': 0
            };
            
            denuncias.forEach(d => {
                if (categorias.hasOwnProperty(d.categoria)) {
                    categorias[d.categoria]++;
                }
            });
            
            // Mostra se√ß√£o de categorias se houver den√∫ncias
            const categoryStatsSection = document.getElementById('category-stats');
            if (total > 0) {
                categoryStatsSection.style.display = 'block';
                
                // Renderiza estat√≠sticas por categoria
                const categoryStatsGrid = document.getElementById('category-stats-grid');
                categoryStatsGrid.innerHTML = Object.entries(categorias)
                    .filter(([_, count]) => count > 0) // S√≥ mostra categorias com den√∫ncias
                    .sort((a, b) => b[1] - a[1]) // Ordena por quantidade (decrescente)
                    .map(([categoria, count]) => {
                        const info = getCategoriaInfo(categoria);
                        const percentage = ((count / total) * 100).toFixed(1);
                        return `
                            <div class="category-stat-item ${categoria}">
                                <div class="category-name">
                                    ${info.icone} ${info.label}
                                </div>
                                <div class="category-count">${count}</div>
                                <div style="font-size: 0.85em; color: #636e72; margin-top: 5px;">
                                    ${percentage}% do total
                                </div>
                            </div>
                        `;
                    }).join('');
            } else {
                categoryStatsSection.style.display = 'none';
            }
        }
        
        // Fun√ß√µes de Filtros
        function showFilters() {
            // Mostra a se√ß√£o de filtros avan√ßados sem selecionar nada
            const filtersSection = document.getElementById('filters-section');
            filtersSection.style.display = 'block';
            // N√£o faz scroll - deixa o usu√°rio aplicar os filtros primeiro
        }
        
        function filterByStatus(status) {
            // Se status vazio, limpa todos os filtros
            if (!status) {
                clearFilters();
                return;
            }
            
            const filtersSection = document.getElementById('filters-section');
            filtersSection.style.display = 'block';
            
            // Atualiza o select de status
            document.getElementById('filter-status').value = status;
            activeFilters.status = status;
            
            // Aplica os filtros e faz scroll para os resultados
            applyFilters(true);
        }
        
        function applyFilters(forceScroll = false) {
            // Pega os valores dos filtros
            activeFilters.status = document.getElementById('filter-status').value;
            activeFilters.categoria = document.getElementById('filter-categoria').value;
            activeFilters.data = document.getElementById('filter-data').value;
            activeFilters.search = document.getElementById('search-input').value.toLowerCase();
            
            // Aplica os filtros
            filteredDenuncias = allDenuncias.filter(d => {
                // Filtro de status
                if (activeFilters.status && d.status !== activeFilters.status) {
                    return false;
                }
                
                // Filtro de categoria
                if (activeFilters.categoria && d.categoria !== activeFilters.categoria) {
                    return false;
                }
                
                // Filtro de data
                if (activeFilters.data) {
                    const dataDenuncia = new Date(d.data_criacao);
                    const hoje = new Date();
                    const diffTime = hoje - dataDenuncia;
                    const diffDays = diffTime / (1000 * 60 * 60 * 24);
                    
                    if (activeFilters.data === 'hoje' && diffDays > 1) return false;
                    if (activeFilters.data === 'semana' && diffDays > 7) return false;
                    if (activeFilters.data === 'mes' && diffDays > 30) return false;
                    if (activeFilters.data === 'tres_meses' && diffDays > 90) return false;
                }
                
                // Filtro de busca
                if (activeFilters.search) {
                    const searchLower = activeFilters.search;
                    const descricao = (d.descricao || '').toLowerCase();
                    const localizacao = (d.localizacao || '').toLowerCase();
                    const usuario = (d.usuario_nome || 'an√¥nimo').toLowerCase();
                    
                    if (!descricao.includes(searchLower) && 
                        !localizacao.includes(searchLower) && 
                        !usuario.includes(searchLower)) {
                        return false;
                    }
                }
                
                return true;
            });
            
            // Renderiza as den√∫ncias filtradas
            renderDenuncias();
            
            // Atualiza as tags de filtros ativos
            updateFilterTags();
            
            // Atualiza os cards de estat√≠sticas
            updateStatCardsHighlight();
            
            // Scroll para resultados apenas se h√° filtros ativos ou foi for√ßado (clique em card)
            const hasActiveFilters = activeFilters.status || activeFilters.categoria || 
                                   activeFilters.data || activeFilters.search;
            
            if (hasActiveFilters || forceScroll) {
                setTimeout(() => {
                    document.getElementById('denuncias-tab').scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }, 100);
            }
        }
        
        function clearFilters() {
            // Limpa todos os filtros
            document.getElementById('filter-status').value = '';
            document.getElementById('filter-categoria').value = '';
            document.getElementById('filter-data').value = '';
            document.getElementById('search-input').value = '';
            
            activeFilters = {
                status: '',
                categoria: '',
                data: '',
                search: ''
            };
            
            // Reseta para todas as den√∫ncias
            filteredDenuncias = allDenuncias;
            
            // Renderiza
            renderDenuncias();
            
            // Limpa tags
            document.getElementById('filter-active-tags').innerHTML = '';
            
            // Remove destaque dos cards
            updateStatCardsHighlight();
            
            // Esconde a se√ß√£o de filtros
            document.getElementById('filters-section').style.display = 'none';
        }
        
        function updateFilterTags() {
            const tagsContainer = document.getElementById('filter-active-tags');
            let tagsHTML = '';
            
            if (activeFilters.status) {
                tagsHTML += `<div class="filter-tag" onclick="removeFilter('status')" title="Clique para remover">
                    <i class="fas fa-flag"></i> Status: ${getStatusLabel(activeFilters.status)}
                    <span class="remove-filter">√ó</span>
                </div>`;
            }
            
            if (activeFilters.categoria) {
                const catInfo = getCategoriaInfo(activeFilters.categoria);
                tagsHTML += `<div class="filter-tag" onclick="removeFilter('categoria')" title="Clique para remover">
                    <i class="fas fa-tags"></i> ${catInfo.icone} ${catInfo.label}
                    <span class="remove-filter">√ó</span>
                </div>`;
            }
            
            if (activeFilters.data) {
                const dataLabels = {
                    'hoje': 'Hoje',
                    'semana': '√öltima semana',
                    'mes': '√öltimo m√™s',
                    'tres_meses': '√öltimos 3 meses'
                };
                tagsHTML += `<div class="filter-tag" onclick="removeFilter('data')" title="Clique para remover">
                    <i class="fas fa-calendar"></i> ${dataLabels[activeFilters.data]}
                    <span class="remove-filter">√ó</span>
                </div>`;
            }
            
            if (activeFilters.search) {
                tagsHTML += `<div class="filter-tag" onclick="removeFilter('search')" title="Clique para remover">
                    <i class="fas fa-search"></i> "${activeFilters.search}"
                    <span class="remove-filter">√ó</span>
                </div>`;
            }
            
            tagsContainer.innerHTML = tagsHTML;
        }
        
        function removeFilter(filterType) {
            // Remove o filtro espec√≠fico
            switch(filterType) {
                case 'status':
                    document.getElementById('filter-status').value = '';
                    activeFilters.status = '';
                    break;
                case 'categoria':
                    document.getElementById('filter-categoria').value = '';
                    activeFilters.categoria = '';
                    break;
                case 'data':
                    document.getElementById('filter-data').value = '';
                    activeFilters.data = '';
                    break;
                case 'search':
                    document.getElementById('search-input').value = '';
                    activeFilters.search = '';
                    break;
            }
            
            // Verifica se ainda h√° filtros ativos
            const hasActiveFilters = activeFilters.status || activeFilters.categoria || 
                                   activeFilters.data || activeFilters.search;
            
            // Se n√£o houver mais filtros, esconde a se√ß√£o de filtros
            if (!hasActiveFilters) {
                document.getElementById('filters-section').style.display = 'none';
            }
            
            // Reaplica os filtros
            applyFilters();
        }
        
        function updateStatCardsHighlight() {
            // Remove destaque de todos os cards
            document.querySelectorAll('.stat-card').forEach(card => {
                card.classList.remove('filtered');
            });
            
            // Adiciona destaque ao card ativo
            if (activeFilters.status) {
                let cardId = '';
                if (activeFilters.status === 'pendente') cardId = 'stat-denuncias';
                else if (activeFilters.status === 'em_andamento') cardId = 'stat-denuncias-andamento';
                else if (activeFilters.status === 'resolvida') cardId = 'stat-denuncias-resolvidas';
                
                if (cardId) {
                    const card = document.getElementById(cardId).closest('.stat-card');
                    if (card) card.classList.add('filtered');
                }
            }
        }

        function toggleDenuncia(id) {
            const card = document.getElementById(`denuncia-${id}`);
            const content = card.querySelector('.item-content');
            const icon = card.querySelector('.expand-icon');
            
            if (card.classList.contains('collapsed')) {
                card.classList.remove('collapsed');
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
                
                // Inicializa o mapa deste card ap√≥s expandir
                setTimeout(() => {
                    const mapElement = content.querySelector('.mini-map[data-lat][data-lng]');
                    if (mapElement && !mapElement.classList.contains('map-initialized')) {
                        initializeMap(mapElement);
                        mapElement.classList.add('map-initialized');
                    }
                }, 50);
            } else {
                card.classList.add('collapsed');
                content.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
            }
        }
        
        function createTimeline(denuncia) {
            if (!denuncia.historico || denuncia.historico.length === 0) {
                return '';
            }
            
            let html = '<div class="timeline-container">';
            html += '    <div class="timeline-header">';
            html += '        <h4><i class="fas fa-history"></i> Hist√≥rico da Den√∫ncia</h4>';
            html += '        <button class="btn-add-comment" onclick="toggleCommentForm(' + denuncia.id + ')">';
            html += '            <i class="fas fa-plus"></i> Adicionar Coment√°rio';
            html += '        </button>';
            html += '    </div>';
            html += '    <div class="comment-form" id="comment-form-' + denuncia.id + '">';
            html += '        <textarea id="comment-text-' + denuncia.id + '" placeholder="Digite seu coment√°rio aqui..."></textarea>';
            html += '        <div class="comment-form-actions">';
            html += '            <button class="btn-submit" onclick="adicionarComentario(' + denuncia.id + ')">';
            html += '                <i class="fas fa-check"></i> Enviar';
            html += '            </button>';
            html += '            <button class="btn-cancel" onclick="toggleCommentForm(' + denuncia.id + ')">';
            html += '                <i class="fas fa-times"></i> Cancelar';
            html += '            </button>';
            html += '        </div>';
            html += '    </div>';
            html += '    <div class="timeline">';
            
            denuncia.historico.forEach(item => {
                const data = new Date(item.data_criacao);
                const dataFormatada = data.toLocaleDateString('pt-BR') + ' √†s ' + data.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'});
                
                html += '        <div class="timeline-item tipo-' + item.tipo + '">';
                html += '            <div class="timeline-content">';
                html += '                <div class="timeline-header-info">';
                html += '                    <div class="timeline-type">';
                
                // √çcone baseado no tipo
                if (item.tipo === 'criacao') {
                    html += '<i class="fas fa-flag" style="color: #4CAF50;"></i>';
                } else if (item.tipo === 'status') {
                    html += '<i class="fas fa-exchange-alt" style="color: #2196F3;"></i>';
                } else if (item.tipo === 'comentario') {
                    html += '<i class="fas fa-comment" style="color: #FF9800;"></i>';
                }
                
                html += item.tipo_display;
                html += '                    </div>';
                html += '                    <div class="timeline-date">' + dataFormatada + '</div>';
                html += '                </div>';
                
                if (item.usuario_nome) {
                    html += '                <div class="timeline-user">';
                    html += '                    <i class="fas fa-user"></i> ' + item.usuario_nome;
                    html += '                </div>';
                }
                
                if (item.status_anterior && item.status_novo) {
                    html += '                <div class="timeline-status-change">';
                    html += '                    <span class="status-badge status-' + item.status_anterior + '">' + getStatusLabel(item.status_anterior) + '</span>';
                    html += '                    <i class="fas fa-arrow-right"></i>';
                    html += '                    <span class="status-badge status-' + item.status_novo + '">' + getStatusLabel(item.status_novo) + '</span>';
                    html += '                </div>';
                }
                
                if (item.comentario) {
                    html += '                <div class="timeline-message">' + item.comentario + '</div>';
                }
                
                html += '            </div>';
                html += '        </div>';
            });
            
            html += '    </div>';
            html += '</div>';
            
            return html;
        }
        
        function createMediaGallery(denuncia) {
            let html = '';
            const midias = [];
            
            // Verifica se tem coordenadas na localiza√ß√£o
            const coordMatch = denuncia.localizacao.match(/Coordenadas:\s*([-\d.]+),\s*([-\d.]+)/);
            
            if (coordMatch) {
                const lat = parseFloat(coordMatch[1]);
                const lng = parseFloat(coordMatch[2]);
                const mapId = 'map-' + denuncia.id;
                const endereco = denuncia.localizacao.split('(Coordenadas')[0].trim();
                
                html += '<div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;">';
                html += '<h4 style="color: #4CAF50; display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">';
                html += '<i class="fas fa-map-marked-alt"></i> Localiza√ß√£o no Mapa';
                html += '</h4>';
                html += '<div id="' + mapId + '" class="mini-map" data-lat="' + lat + '" data-lng="' + lng + '" data-endereco="' + endereco.replace(/"/g, '&quot;') + '" style="height: 250px; border-radius: 8px; border: 2px solid #ddd; background: #e9ecef;"></div>';
                html += '</div>';
            }
            
            // Adiciona imagem principal
            if (denuncia.imagem_url) {
                midias.push({tipo: 'imagem', url: denuncia.imagem_url});
            }
            
            // Adiciona v√≠deo principal
            if (denuncia.video_url) {
                midias.push({tipo: 'video', url: denuncia.video_url});
            }
            
            // Adiciona imagens adicionais
            if (denuncia.imagens_urls && denuncia.imagens_urls.length > 0) {
                denuncia.imagens_urls.forEach(url => {
                    midias.push({tipo: 'imagem', url: url});
                });
            }
            
            // Adiciona v√≠deos adicionais
            if (denuncia.videos_urls && denuncia.videos_urls.length > 0) {
                denuncia.videos_urls.forEach(url => {
                    midias.push({tipo: 'video', url: url});
                });
            }
            
            if (midias.length === 0 && !coordMatch) {
                return '<p style="color: #999; font-style: italic;"><i class="fas fa-image"></i> Nenhuma m√≠dia anexada</p>';
            }
            
            if (midias.length > 0) {
                html += '<h4 style="color: #333; margin-top: 15px;">Evid√™ncias Anexadas</h4>';
                html += '<div class="media-gallery">';
                midias.forEach((midia, index) => {
                    if (midia.tipo === 'imagem') {
                        html += '<div class="media-item" data-url="' + midia.url + '" data-type="imagem">';
                        html += '<img src="' + midia.url + '" alt="Evid√™ncia ' + (index + 1) + '">';
                        html += '<div class="media-type-badge"><i class="fas fa-image"></i> Imagem</div>';
                        html += '</div>';
                    } else {
                        html += '<div class="media-item" data-url="' + midia.url + '" data-type="video">';
                        html += '<video src="' + midia.url + '"></video>';
                        html += '<div class="media-type-badge"><i class="fas fa-video"></i> V√≠deo</div>';
                        html += '</div>';
                    }
                });
                html += '</div>';
            }
            
            return html;
        }
        
        function openLightboxWithNav(mediaList, startIndex) {
            currentMediaList = mediaList;
            currentMediaIndex = startIndex;
            showCurrentMedia();
            
            const lightbox = document.getElementById('media-lightbox');
            lightbox.classList.add('active');
            
            // Atualiza visibilidade das setas
            updateNavigationButtons();
        }
        
        function showCurrentMedia() {
            const media = currentMediaList[currentMediaIndex];
            const content = document.getElementById('lightbox-content');
            const counter = document.getElementById('lightbox-counter');
            
            if (media.type === 'imagem') {
                content.innerHTML = `<img src="${media.url}" style="max-width: 100%; max-height: 90vh; border-radius: 10px;">`;
            } else {
                content.innerHTML = `<video src="${media.url}" controls style="max-width: 100%; max-height: 90vh; border-radius: 10px;"></video>`;
            }
            
            // Atualiza contador
            counter.textContent = `${currentMediaIndex + 1} / ${currentMediaList.length}`;
            counter.style.display = currentMediaList.length > 1 ? 'block' : 'none';
        }
        
        function navigateLightbox(direction) {
            currentMediaIndex += direction;
            
            // Loop circular
            if (currentMediaIndex < 0) {
                currentMediaIndex = currentMediaList.length - 1;
            } else if (currentMediaIndex >= currentMediaList.length) {
                currentMediaIndex = 0;
            }
            
            showCurrentMedia();
            updateNavigationButtons();
        }
        
        function updateNavigationButtons() {
            const prevBtn = document.querySelector('.lightbox-prev');
            const nextBtn = document.querySelector('.lightbox-next');
            
            // Mostra/esconde bot√µes se houver apenas 1 m√≠dia
            if (currentMediaList.length <= 1) {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
            } else {
                prevBtn.style.display = 'block';
                nextBtn.style.display = 'block';
            }
        }
        
        function openLightbox(url, tipo) {
            // Fallback para compatibilidade
            openLightboxWithNav([{url, type: tipo}], 0);
        }
        
        function closeLightbox() {
            const lightbox = document.getElementById('media-lightbox');
            const content = document.getElementById('lightbox-content');
            lightbox.classList.remove('active');
            content.innerHTML = '';
            currentMediaList = [];
            currentMediaIndex = 0;
        }
        
        // Fun√ß√µes para o sistema de timeline/coment√°rios
        function toggleCommentForm(denunciaId) {
            const form = document.getElementById(`comment-form-${denunciaId}`);
            if (form) {
                form.classList.toggle('active');
                if (form.classList.contains('active')) {
                    // Foca no textarea quando o formul√°rio √© aberto
                    const textarea = form.querySelector('textarea');
                    if (textarea) textarea.focus();
                }
            }
        }
        
        async function adicionarComentario(denunciaId) {
            const textarea = document.getElementById(`comment-text-${denunciaId}`);
            const comentario = textarea.value.trim();
            
            if (!comentario) {
                alert('Por favor, digite um coment√°rio.');
                return;
            }
            
            try {
                // Busca o token da mesma forma que as outras fun√ß√µes
                const token = localStorage.getItem('access');
                
                const response = await fetch(`http://localhost:8000/api/denuncias/${denunciaId}/adicionar_comentario/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ comentario })
                });
                
                console.log('Response status:', response.status);
                const responseData = await response.json();
                console.log('Response data:', responseData);
                
                if (response.status === 401 || response.status === 403) {
                    alert('Sess√£o expirada. Fa√ßa login novamente.');
                    window.location.href = '/login/';
                    return;
                }
                
                if (response.ok) {
                    // Limpa o textarea
                    textarea.value = '';
                    // Fecha o formul√°rio
                    toggleCommentForm(denunciaId);
                    // Recarrega as den√∫ncias para mostrar o novo coment√°rio
                    loadDenuncias();
                    alert('Coment√°rio adicionado com sucesso!');
                } else {
                    alert(`Erro ao adicionar coment√°rio: ${responseData.error || responseData.detail || JSON.stringify(responseData)}`);
                }
            } catch (error) {
                console.error('Erro ao adicionar coment√°rio:', error);
                alert('Erro ao adicionar coment√°rio. Verifique sua conex√£o.');
            }
        }
        
        // Suporte para navega√ß√£o com teclado
        document.addEventListener('keydown', function(e) {
            const lightbox = document.getElementById('media-lightbox');
            if (!lightbox.classList.contains('active')) return;
            
            if (e.key === 'ArrowLeft') {
                navigateLightbox(-1);
            } else if (e.key === 'ArrowRight') {
                navigateLightbox(1);
            } else if (e.key === 'Escape') {
                closeLightbox();
            }
        });
        
        function initializeMap(mapElement) {
            const lat = parseFloat(mapElement.getAttribute('data-lat'));
            const lng = parseFloat(mapElement.getAttribute('data-lng'));
            const endereco = mapElement.getAttribute('data-endereco');
            const mapId = mapElement.id;
            
            try {
                // Cria o mapa
                const miniMap = L.map(mapId, {
                    attributionControl: true,
                    zoomControl: true
                }).setView([lat, lng], 15);
                
                // Adiciona o tile layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '¬© OpenStreetMap'
                }).addTo(miniMap);
                
                // Adiciona o marcador vermelho
                const marker = L.marker([lat, lng], {
                    icon: L.icon({
                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41],
                        popupAnchor: [1, -34],
                        shadowSize: [41, 41]
                    })
                }).addTo(miniMap);
                
                // Adiciona popup com o endere√ßo
                marker.bindPopup('<b>Local da Den√∫ncia</b><br>' + endereco).openPopup();
                
                // Recalcula o tamanho do mapa algumas vezes para garantir renderiza√ß√£o correta
                setTimeout(() => miniMap.invalidateSize(), 100);
                setTimeout(() => miniMap.invalidateSize(), 300);
                
            } catch(e) {
                console.error('Erro ao criar mapa ' + mapId + ':', e);
            }
        }
        
        function initializeMaps() {
            // Inicializa mapas que est√£o vis√≠veis (cards expandidos)
            document.querySelectorAll('.mini-map[data-lat][data-lng]:not(.map-initialized)').forEach(mapElement => {
                const card = mapElement.closest('.item-card');
                if (card && !card.classList.contains('collapsed')) {
                    initializeMap(mapElement);
                    mapElement.classList.add('map-initialized');
                }
            });
        }

        // Iniciar ao carregar p√°gina
        init();
    </script>
</body>
</html>
